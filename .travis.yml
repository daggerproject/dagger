language: cpp
os:
  - osx
  - linux

compiler:
  - clang
  - gcc

matrix:
  exclude:
    - os: osx
      compiler: gcc

install:
  - |
    if [ $TRAVIS_OS_NAME == osx ]; then
      brew update && brew upgrade cmake
    else
      sudo add-apt-repository --yes ppa:ubuntu-toolchain-r/test
      sudo apt-get update -qq
      sudo apt-get install g++-4.8
      export CC=gcc-4.8; export CXX=g++-4.8
      mkdir cmakebin && wget --no-check-certificate -O - "https://cmake.org/files/v3.5/cmake-3.5.2-Linux-x86_64.tar.gz" | tar xz --strip-components 1 -C cmakebin
      export PATH="$PWD/cmakebin/bin:$PATH"
    fi

env:
  - CMAKE_BUILD_TYPE=Release
  - CMAKE_BUILD_TYPE=Debug

script:
  - mkdir build && cd build
  - cmake .. -DCMAKE_BUILD_TYPE="${CMAKE_BUILD_TYPE}" -DLLVM_TARGETS_TO_BUILD="X86"
  - make -j3
  - ./bin/llvm-lit -v test/DC test/MC/Analysis test/tools/llvm-objdump

notifications:
  email:
    recipients:
      - "dagger@repzret.org"
